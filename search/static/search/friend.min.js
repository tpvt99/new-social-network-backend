$('.ev-add').on('click', function() {var $this = $(this);var csrftoken = getCookie('csrftoken');$.ajaxSetup({beforeSend: function(xhr, settings) {if (!csrfSafeMethod(settings.type) && !this.crossDomain) {xhr.setRequestHeader('X-CSRFToken', csrftoken);}}});$.ajax({method : 'POST',url : '/friend/add/',data : {'key':$this[0].dataset.set,'fr':$this[0].dataset.fr},success: function(data) {if(data==='connect') {$this.css({'background-color':'#fff','color':'#111','border-color':'#111'}).text('Hủy kết bạn');$this[0].dataset.fr = 'decline';} else if(data === 'decline') {$this.text('').prepend($('<span class="ion ion-network"></span><span style="margin-left:5px;">Kết nối bạn bè</span>')).css({'background-color':'rgba(32,28,89,0.9)','color':'#fff'});$this[0].dataset.fr = 'connect';if($this.siblings('button[data-fr="accept"]')[0]) {$this.siblings('button[data-fr="accept"]').remove();}} else if(data === 'accept') {if($this.siblings('button[data-fr="decline"]')[0]) {$this.siblings('button[data-fr="decline"]').remove();}$this.text('Bạn bè').prop('disabled','true').dataset.fr = "friend";}else {alert('Có lỗi xảy ra. Xin vui lòng thử lại');}}});});
